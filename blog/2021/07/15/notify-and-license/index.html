<html>
  <head>
    <title>Notify and License - canhazdb</title>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="apple-touch-icon" sizes="180x180" href="/img/apple-touch-icon.png">
    <link rel="icon" type="image/png" href="/img/favicon.png">

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.6.0/styles/atom-one-dark.min.css" integrity="sha512-Fcqyubi5qOvl+yCwSJ+r7lli+CO1eHXMaugsZrnxuU4DVpLYWXTVoHy55+mCb4VZpMgy7PBhV7IiymC0yu9tkQ==" crossorigin="anonymous" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.6.0/highlight.min.js" integrity="sha512-zol3kFQ5tnYhL7PzGt0LnllHHVWRGt2bTCIywDiScVvLIlaDOVJ6sPdJTVi0m3rA660RT+yZxkkRzMbb1L8Zkw==" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.6.0/languages/javascript.min.js" integrity="sha512-u9dJCEIlcxWLWzlBIBDAO98TI5r1yrxGwRY2vbqFdecd58lamsEgBt1p4sDNBncNUMDV5//WdywRHdhCLx0FJQ==" crossorigin="anonymous"></script>

    <link rel="stylesheet" href="/css/header.css" />
    <link rel="stylesheet" href="/css/style.css" />
    <link rel="stylesheet" href="/css/fonts.css" />

    <script>
      document.addEventListener('DOMContentLoaded', (event) => {
        document.querySelectorAll('pre code').forEach((block) => {
          hljs.highlightBlock(block);
        });
      });

      function toggleBurgerMenu () {
        document.body.classList.toggle('burger-open');
      }
    </script>
    <base href="/" />

    <link rel="icon" type="image/png" href="/img/favicon.png" />
  </head>

  <body>
    <header class="menu-header">
      <div class="header-container">
        <div class="header-brand">
          <a href="/">
            <img src="/img/logo.svg" class="logo-icon" />
            <span>canhazdb</span>
          </a>
        </div>
        <div class="header-burger" onclick="toggleBurgerMenu()">
          <svg viewBox="0 0 100 80" width="25" height="25">
            <rect width="100" height="10"></rect>
            <rect y="30" width="100" height="10"></rect>
            <rect y="60" width="100" height="10"></rect>
          </svg>
        </div>
        
    <nav class="bugerable">
      <a href="/" false>Home</a>
      <a href="/docs" false>Docs</a>
      <a href="/blog" class="active">Blog</a>
      <a href="https://github.com/canhazdb/server/discussions">Community</a>
    </nav>
  
      </div>
    </header>

    <main>
      <div class="with-sidebar"><div class="thin content"><sidebar><ul><li><span>August 2021</span><ul><li><span>15</span><a href="/blog/2021/07/15/notify-and-license">Notify and license</a></li><li><span>11</span><a href="/blog/2021/07/11/ha-update">Ha update</a></li></ul></li><li><span>June 2021</span><ul><li><span>15</span><a href="/blog/2021/05/15/reducing-noise">Reducing noise</a></li><li><span>5</span><a href="/blog/2021/05/05/performance-bug">Performance bug</a></li><li><span>1</span><a href="/blog/2021/05/01/websockets-insert">Websockets insert</a></li></ul></li><li><span>May 2021</span><ul><li><span>23</span><a href="/blog/2021/04/23/stability">Stability</a></li></ul></li><li><span>February 2021</span><ul><li><span>8</span><a href="/blog/2021/01/08/introduction">Introduction</a></li></ul></li></ul></sidebar><section><div class="content-heading"><h1>Notify and License<small>Published by <a href="https://markwylde.com" target="_blank">Mark Wylde</a> on 2021-08-15</small></h1><div class="content-info"><a target="_blank" class="edit-page" href="https://github.com/canhazdb/documentation/blob/master/content/blog/2021-08-15-notify-and-license.md">Edit this page</a></div></div><div><p>I&#39;ve just finished implementing the notify logic. Logic has now been implemented to detect a temporary primary replica called <code>isDocumentPrimaryReplica</code>.</p>
<p>This can be used from an internal controller, when an action should be performed only once per internal method. For example:</p>
<ol>
<li>When you have <code>PATCH</code>ed 1 document that has 3 replicas, it should only <code>NOTIFY</code> once.</li>
<li>When you need to return the effected documents (not replicas).</li>
</ol>
<p>The current logic is:</p>
<pre><code class="language-javascript">function isDocumentPrimaryReplica (context, document) {
  return document._replicatedNodes[0] === context.thisNode.name;
}
</code></pre>
<p>But ideally, this needs to <em>also</em> take into consideration if the actual primary replica is offline/unhealthy. I&#39;ll get to that later.</p>
<h2 id="license-change">License change</h2>
<p>The main project is deliberately licensed as <a href="https://github.com/canhazdb/server/blob/master/LICENSE">AGPL-3</a>, but I realised the client library was also licensed as AGPL-3 too.</p>
<p>That was not my intention. If you want to use the canhazdb client library, you do not have to release your entire app as AGPL-3. For example, if you run a canhazdb server cluster, and then build a separate app that talks to the server (either using the client library or your own), the project does not have to be licensed as <a href="https://github.com/canhazdb/server/blob/master/LICENSE">AGPL-3</a>.</p>
<p>Therefore, I have changed the <a href="https://github.com/canhazdb/client">canhazdb client</a> license to be <a href="https://github.com/canhazdb/client/blob/master/LICENSE">MIT</a>.</p>
<p>Note, the license of the <a href="https://github.com/canhazdb/client">canhazdb server</a> is still <a href="https://github.com/canhazdb/server/blob/master/LICENSE">AGPL-3</a>. The intention being, if you make any changes to the server or embed it into another product, the project should be licensed as <a href="https://github.com/canhazdb/server/blob/master/LICENSE">AGPL-3</a> and source code released.</p>
<h2 id="next---statistics">Next - Statistics</h2>
<p>The last major feature for me to implement is the <code>system.collections</code> collection. I&#39;ll try to get that completed this week.</p>
<p>Once that&#39;s finished, I&#39;m going to embed a very simple http server (without websocket notify support). Then finally, I can get the <a href="https://github.com/canhazdb/server/tree/ha">ha branch</a> into master. Milestone reached!</p>
</div><hr></section></div></div>
    </main>
  </body>
</html>
