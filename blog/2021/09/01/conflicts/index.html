<html>
  <head>
    <title>Conflicts - canhazdb</title>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="apple-touch-icon" sizes="180x180" href="/img/apple-touch-icon.png">
    <link rel="icon" type="image/png" href="/img/favicon.png">

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.6.0/styles/atom-one-dark.min.css" integrity="sha512-Fcqyubi5qOvl+yCwSJ+r7lli+CO1eHXMaugsZrnxuU4DVpLYWXTVoHy55+mCb4VZpMgy7PBhV7IiymC0yu9tkQ==" crossorigin="anonymous" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.6.0/highlight.min.js" integrity="sha512-zol3kFQ5tnYhL7PzGt0LnllHHVWRGt2bTCIywDiScVvLIlaDOVJ6sPdJTVi0m3rA660RT+yZxkkRzMbb1L8Zkw==" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.6.0/languages/javascript.min.js" integrity="sha512-u9dJCEIlcxWLWzlBIBDAO98TI5r1yrxGwRY2vbqFdecd58lamsEgBt1p4sDNBncNUMDV5//WdywRHdhCLx0FJQ==" crossorigin="anonymous"></script>

    <link rel="stylesheet" href="/css/header.css" />
    <link rel="stylesheet" href="/css/style.css" />
    <link rel="stylesheet" href="/css/fonts.css" />

    <script>
      document.addEventListener('DOMContentLoaded', (event) => {
        document.querySelectorAll('pre code').forEach((block) => {
          hljs.highlightBlock(block);
        });
      });

      function toggleBurgerMenu () {
        document.body.classList.toggle('burger-open');
      }
    </script>
    <base href="/" />

    <link rel="icon" type="image/png" href="/img/favicon.png" />
  </head>

  <body>
    <header class="menu-header">
      <div class="header-container">
        <div class="header-brand">
          <a href="/">
            <img src="/img/logo.svg" class="logo-icon" />
            <span>canhazdb</span>
          </a>
        </div>
        <div class="header-burger" onclick="toggleBurgerMenu()">
          <svg viewBox="0 0 100 80" width="25" height="25">
            <rect width="100" height="10"></rect>
            <rect y="30" width="100" height="10"></rect>
            <rect y="60" width="100" height="10"></rect>
          </svg>
        </div>
        
    <nav class="bugerable">
      <a href="/" false>Home</a>
      <a href="/docs" false>Docs</a>
      <a href="/blog" class="active">Blog</a>
      <a href="https://github.com/canhazdb/server/discussions">Community</a>
    </nav>
  
      </div>
    </header>

    <main>
      <div class="with-sidebar"><div class="thin content"><sidebar><ul><li><span>October 2021</span><ul><li><span>1</span><a href="/blog/2021/09/01/conflicts">Conflicts</a></li></ul></li><li><span>August 2021</span><ul><li><span>15</span><a href="/blog/2021/07/15/notify-and-license">Notify and license</a></li><li><span>11</span><a href="/blog/2021/07/11/ha-update">Ha update</a></li></ul></li><li><span>June 2021</span><ul><li><span>15</span><a href="/blog/2021/05/15/reducing-noise">Reducing noise</a></li><li><span>5</span><a href="/blog/2021/05/05/performance-bug">Performance bug</a></li><li><span>1</span><a href="/blog/2021/05/01/websockets-insert">Websockets insert</a></li></ul></li><li><span>May 2021</span><ul><li><span>23</span><a href="/blog/2021/04/23/stability">Stability</a></li></ul></li><li><span>February 2021</span><ul><li><span>8</span><a href="/blog/2021/01/08/introduction">Introduction</a></li></ul></li></ul></sidebar><section><div class="content-heading"><h1 id="Conflicts"><a href="/blog/#Conflicts">Conflicts</a><small>Published by <a href="https://markwylde.com" target="_blank">Mark Wylde</a> on 2021-10-01</small></h1><div class="content-info"><a target="_blank" class="edit-page" href="https://github.com/canhazdb/documentation/blob/master/content/blog/2021-10-01-conflicts.md">Edit this page</a><em>Last updated: 2021-10-02</em></div></div><div><p>I&#39;ve been slowly working through the last of the issues and feel like version 8 is very close to getting merged into master and released.</p>
<h2 id="conflicts">Conflicts</h2>
<p>Conflict&#39;s have been completed, and will now attempt to resolve when a node recovers. The cleanup logic took a lot longer than I thought, but due to my own over complication of the strategy.</p>
<p>While resolving conflicts was as easy as letting all other nodes know about the resolution, and syncing with other nodes on startup, the deletion was trickier. We can only delete a conflict, once all other nodes have successfully received the conflict resolutions.</p>
<p>I&#39;m sure there are improvements that can be made to the efficiency of the conflict implementation, but I&#39;m happy that for now conflicts seem to be working well.</p>
<h2 id="system-collections">System Collections</h2>
<p>The main system collections have been implemented:</p>
<ul>
<li><code>system.collections</code></li>
<li><code>system.notifys</code></li>
<li><code>system.locks</code></li>
<li><code>system.nodes</code></li>
</ul>
<p>The schema has changed a little from my initial idea, but the main information is still there.</p>
<p>It did identify one issue that I need to seed the system collections to the <code>system.collections</code>. I don&#39;t want to hard code this in, and would prefer each module is responsible for its own seeding.</p>
<p>But as there isn&#39;t the concept of &quot;installing&quot; the database, I might have to just check on every node start, if the collection has been added. It seems a little inefficient, but efficiency can be improved later.</p>
<h2 id="http-endpoints">Http Endpoints</h2>
<p>The http server for issue <a href="https://github.com/canhazdb/server/issues/61">#61</a> has been implemented, but I&#39;ve only managed to write the get collections and get documents endpoints. It went pretty smoothly, and I hope the other endpoints will not take too long.</p>
<h2 id="required-certs">Required Certs</h2>
<p>I&#39;ve been trying to keep both <code>TLS</code> and <code>unencrypted tcp</code> to allow for easier development environments. But I&#39;m becoming more uncomfortable with having this mix and match of tcp/http that can be secure or insecure. Plus, the NodeJS http2 library doesn&#39;t support none TLS communication.</p>
<p>Therefore, certs/TLS is now required for all instances running. You will not be able to connect to the http or TLS ports without full TLS validation.</p>
<p>The one exception will be the web UI client. That will use the same certs and be delivered over TLS, but it will not verify the client certificate. This means, you can access the web UI in your browser, but not the http api endpoints.</p>
<h2 id="next">Next</h2>
<p>Currently, I&#39;m working on finishing the http endpoints, then will put a simple version check to ensure all nodes are on the same major version.</p>
<p>That will complete the last of the issues for the v8 release.</p>
<p>But before I merge and release, I need to properly update the documentation. Most importantly, I want to document the &quot;canhazdb protocol&quot;.</p>
</div><hr></section></div></div>
    </main>
  </body>
</html>
